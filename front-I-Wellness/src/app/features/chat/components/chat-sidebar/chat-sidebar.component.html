<div class="chat-sidebar" [class.visible]="isVisible$ | async">
  <!-- Sidebar Header -->
  <div class="sidebar-header">
    <h2 class="sidebar-title">
      <mat-icon>contacts</mat-icon>
      Proveedores
    </h2>

    <button
      mat-icon-button
      class="close-button"
      (click)="onToggleSidebar()"
      [attr.aria-label]="'Cerrar sidebar'">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Search and Filters -->
  <div class="filters-section">
    <!-- Search Bar -->
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Buscar proveedores</mat-label>
      <input
        matInput
        [formControl]="searchControl"
        placeholder="Nombre, contacto o servicio..."
        autocomplete="off">
      <mat-icon matPrefix>search</mat-icon>
      <button
        *ngIf="searchControl.value"
        matSuffix
        mat-icon-button
        (click)="onClearSearch()"
        [attr.aria-label]="'Limpiar búsqueda'">
        <mat-icon>clear</mat-icon>
      </button>
    </mat-form-field>

    <!-- Filter Controls -->
    <div class="filter-controls">
      <mat-form-field appearance="outline" class="sort-field">
        <mat-label>Ordenar por</mat-label>
        <mat-select [formControl]="sortControl">
          <mat-option
            *ngFor="let option of sortOptions"
            [value]="option.value">
            {{ option.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Filtrar</mat-label>
        <mat-select [formControl]="filterControl">
          <mat-option
            *ngFor="let option of filterOptions"
            [value]="option.value">
            {{ option.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Results Summary -->
    <div class="results-summary">
      <span class="results-count">
        {{ totalProviders }} {{ totalProviders === 1 ? 'proveedor' : 'proveedores' }}
      </span>
      <button
        mat-icon-button
        class="refresh-button"
        (click)="onRefresh()"
        [disabled]="isLoading"
        [attr.aria-label]="'Actualizar lista'">
        <mat-icon [class.rotating]="isLoading">refresh</mat-icon>
      </button>
    </div>
  </div>

  <!-- Provider List -->
  <div class="provider-list">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Cargando proveedores...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !isLoading" class="error-state">
      <mat-icon class="error-icon">error_outline</mat-icon>
      <p>{{ error }}</p>
      <button mat-button color="primary" (click)="onRefresh()">
        Reintentar
      </button>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && !error && paginatedProviders.length === 0" class="empty-state">
      <mat-icon class="empty-icon">search_off</mat-icon>
      <p>No se encontraron proveedores</p>
      <p class="empty-subtitle">Intenta ajustar tus filtros de búsqueda</p>
    </div>

    <!-- Provider Cards -->
    <div *ngIf="!isLoading && !error && paginatedProviders.length > 0" class="cards-container">
      <app-contact-card
        *ngFor="let provider of paginatedProviders; let i = index; trackBy: trackByProvider"
        [provider]="provider"
        [isSelected]="selectedProvider?.id === provider.id"
        [animationClass]="getAnimationClass(i)"
        [compactMode]="true"
        [showServices]="true"
        (cardClick)="onProviderSelect(provider)"
        (chatClick)="onProviderChat(provider)"
        (profileClick)="onProviderProfile(provider)">
      </app-contact-card>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="totalProviders > pageSize && !isLoading && !error" class="pagination-section">
    <mat-paginator
      [length]="totalProviders"
      [pageSize]="pageSize"
      [pageIndex]="currentPage"
      [pageSizeOptions]="[5, 10, 20, 50]"
      [showFirstLastButtons]="true"
      (page)="onPageChange($event)"
      aria-label="Seleccionar página de proveedores">
    </mat-paginator>
  </div>
</div>
